# Plate Detection & Masking

Система автоматической детекции и маскирования номерных знаков на изображениях с использованием YOLOv8 Segmentation.

## Возможности

- Детекция номерных знаков на изображениях
- Два режима маскирования:
  - Размытие номера (Gaussian blur)
  - Наложение плашки поверх номера
- Пакетная обработка изображений
- Поддержка GPU (CUDA) и CPU
- Django-интеграция для веб-сервисов

## Установка

### 1. Клонировать репозиторий

```bash
git clone https://github.com/dadaxonEnigma/plate-marker.git
cd plate_det
```

### 2. Установить зависимости

```bash
pip install -r requirements.txt
```

### 3. Скачать модель

Обученная модель находится в:
```
notebooks/runs/segment/train/weights/best.pt
```

## Структура проекта

```
plate_det/
├── src/
│   ├── plate_masker/          # Основной модуль детекции и маскирования
│   │   ├── inference.py       # Класс PlateDetector для детекции
│   │   ├── geometry.py        # Геометрические утилиты
│   │   └── blending.py        # Маскирование и размытие
│   ├── test_inference.py      # Пакетная обработка изображений
│   ├── build_dataset.py       # Подготовка датасета для обучения
│   └── plate_marker_service.py # Django-сервис
├── notebooks/
│   ├── model.ipynb            # Обучение модели
│   └── test.ipynb             # Быстрое тестирование
├── test_images/               # Тестовые изображения (~600 фото)
├── dataset/                   # Датасет для обучения (575 изображений)
├── assets/autouz.png          # Плашка для замены номера
```

## Использование
### Пакетная обработка

Обработать папку с изображениями:

```bash
cd src
python test_inference.py
```

**Настройка в коде:**
- `input_folder` - папка с исходными изображениями
- `output_base` - папка для результатов
- `conf_threshold` - порог уверенности (по умолчанию 0.8)

**Результаты сохраняются в:**
- `outputs/processed/` - изображения с найденными номерами (замаскированы)
- `outputs/no_number/` - изображения без номеров

## Тестирование

### Тест Пакетная обработка

```bash
cd src
python test_inference.py
```

**Проверить:**
1. Создаются папки `outputs/processed/` и `outputs/no_number/`
2. Изображения корректно распределены по папкам
3. На обработанных изображениях номера замаскированы
4. Нет ошибок при обработке различных форматов (jpg, png, webp)

### Тест 3: Интерактивный тест (Jupyter)

```bash
jupyter notebook notebooks/test.ipynb
```

**Проверить:**
- Визуализацию детекций
- Корректность масок на различных ракурсах
- Качество размытия/наложения плашки


## Параметры модели

**Обученная модель (best.pt):**
- Архитектура: YOLOv8s-seg (segmentation)
- Датасет: 575 размеченных изображений
- Train/Val split: 85% / 15%
- Эпох обучения: 100 (early stopping: patience=30)
- Размер входа: 1024x1024
- Оптимизатор: AdamW
- Learning rate: 0.0005

**Параметры инференса:**
- `conf`: порог уверенности (рекомендуется 0.8)
- `imgsz`: размер изображения для модели (рекомендуется 1024)
- `device`: 'cuda:0' (GPU) или 'cpu'

## Известные ограничения

- Модель оптимизирована для узбекских номерных знаков
- Детекция может быть хуже на сильно размытых или малых номерах (< 50px)
- При плохой геометрии полигона (is_bad_quad) применяется размытие вместо плашки
